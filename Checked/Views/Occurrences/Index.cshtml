@using Checked.Models.Models
@using Microsoft.AspNetCore.Identity
@model IEnumerable<Checked.Models.Models.Occurrence>
@inject UserManager<ApplicationUser> UserManager

@{
    ViewData["Title"] = "Index";
    var itens = ViewData["actions"];
    var user = await UserManager.GetUserAsync(User);
}
<div class="cntr">
    <div style="margin-bottom:5px; width:50vh">
        <a class="btn btn-primary" asp-action="Create">Criar nova Ocorrência</a>
    </div>
    <div class="scrollbar" id="style-2">
        <table style="font-size:13px;font-weight: 600;" class="table table-hover table-sm align-middle">
            <thead class="table-dark sticky-top">
                <tr>
                    <th style="border-right:1px solid; border-right-color: rgb(247, 239, 251, .4); ">
                        @Html.DisplayNameFor(model => model.Tp_Ocorrencia.Name)
                    </th>
                    <th style="border-right:1px solid; border-right-color: rgb(247, 239, 251, .4); ">
                        @Html.DisplayNameFor(model => model.Description)
                    </th>
                    <th style="border-right:1px solid; border-right-color: rgb(247, 239, 251, .4); ">
                        @Html.DisplayNameFor(model => model.Additional1)
                    </th>
                    <th style="border-right:1px solid; border-right-color: rgb(247, 239, 251, .4); ">
                        @Html.DisplayNameFor(model => model.Additional2)
                    </th>
                    <th style="border-right:1px solid; border-right-color: rgb(247, 239, 251, .4); ">
                        @Html.DisplayNameFor(model => model.Harmed)
                    </th>
                    <th style="border-right:1px solid; border-right-color: rgb(247, 239, 251, .4); ">
                        @Html.DisplayNameFor(model => model.Document)
                    </th>
                    <th style="border-right:1px solid; border-right-color: rgb(247, 239, 251, .4); ">
                        @Html.DisplayNameFor(model => model.Cost)
                    </th>
                    <th style="border-right:1px solid; border-right-color: rgb(247, 239, 251, .4); ">
                        @Html.DisplayNameFor(model => model.Appraiser)
                    </th>
                    <th style="border-right:1px solid; border-right-color: rgb(247, 239, 251, .4); ">
                        @Html.DisplayNameFor(model => model.Origin)
                    </th>
                    <th style="border-right:1px solid; border-right-color: rgb(247, 239, 251, .4); ">
                        Plano de Ação
                    </th>
                    <th style="border-right:1px solid; border-right-color: rgb(247, 239, 251, .4); ">
                        @Html.DisplayNameFor(model => model.StatusActions)
                    </th>
                    <th style="border-right:1px solid; border-right-color: rgb(247, 239, 251, .4); ">
                        @Html.DisplayNameFor(model => model.Status)
                    </th>
                    <th style="border-right:1px solid; border-right-color: rgb(247, 239, 251, .4); ">
                        @Html.DisplayNameFor(model => model.CorrectiveAction)
                    </th>
                    <th style="border-right:1px solid; border-right-color: rgb(247, 239, 251, .4); "></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td style="border-right:1px solid; border-right-color: rgb(247, 239, 251, .4); ">
                            @Html.DisplayFor(modelItem => item.Tp_Ocorrencia.Name)
                        </td>
                        <td style="border-right:1px solid; border-right-color: rgb(247, 239, 251, .4); ">
                            @Html.DisplayFor(modelItem => item.Description)
                        </td>
                        <td style="border-right:1px solid; border-right-color: rgb(247, 239, 251, .4); ">
                            @Html.DisplayFor(modelItem => item.Additional1)
                        </td>
                        <td style="border-right:1px solid; border-right-color: rgb(247, 239, 251, .4); ">
                            @Html.DisplayFor(modelItem => item.Additional1)
                        </td>
                        <td style="border-right:1px solid; border-right-color: rgb(247, 239, 251, .4); ">
                            @Html.DisplayFor(modelItem => item.Harmed)
                        </td>
                        <td style="border-right:1px solid; border-right-color: rgb(247, 239, 251, .4); ">
                            @Html.DisplayFor(modelItem => item.Document)
                        </td>
                        <td style="border-right:1px solid; border-right-color: rgb(247, 239, 251, .4); ">
                            @Html.DisplayFor(modelItem => item.Cost)
                        </td>
                        <td style="border-right:1px solid; border-right-color: rgb(247, 239, 251, .4); ">
                            @Html.DisplayFor(modelItem => item.Appraiser.Name)
                        </td>
                        <td style="border-right:1px solid; border-right-color: rgb(247, 239, 251, .4); ">
                            @Html.DisplayFor(modelItem => item.Origin)
                        </td>
                        <td style="border-right:1px solid; border-right-color: rgb(247, 239, 251, .4); ">
                            <a asp-action="Index" asp-controller="Plans" asp-route-id="@item.Id">Action Plan</a>
                        </td>
                        <td style="border-right:1px solid; border-right-color: rgb(247, 239, 251, .4); ">
                            @Html.DisplayFor(modelItem => item.StatusActions)
                        </td>
                        <td style="border-right:1px solid; border-right-color: rgb(247, 239, 251, .4); ">
                            @Html.DisplayFor(modelItem => item.Status.Name)
                        </td>
                        <td style="border-right:1px solid; border-right-color: rgb(247, 239, 251, .4); ">
                            @Html.DisplayFor(modelItem => item.CorrectiveAction)
                        </td>
                        <td>
                            @if (@item.AppraiserId.Equals(user.Id) || @item.CreatedById.Equals(user.Id))
                            {
                                <a asp-action="Edit" asp-route-idOccurrence="@item.Id">Editar  |</a>
                                <a asp-action="Details" asp-route-idOccurrence="@item.Id">Detalhes |</a>
                                <a asp-action="Delete" asp-route-idOccurrence="@item.Id">Delete</a>
                            }
                            else
                            {
                                <a asp-action="Details" asp-route-idOccurrence="@item.Id">Detalhes</a>
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>
